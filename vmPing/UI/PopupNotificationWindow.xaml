<Window x:Class="vmPing.UI.PopupNotificationWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:resource="clr-namespace:vmPing.Properties"
        UseLayoutRounding="True"
        MinHeight="130"
        MaxHeight="800"
        MinWidth="500"
        SizeToContent="WidthAndHeight"
        ResizeMode="NoResize"
        WindowStyle="None"
        ShowInTaskbar="False"
        Background="Transparent"
        BorderThickness="0"
        Topmost="True"
        ShowActivated="False"
        MouseLeftButtonUp="Window_MouseLeftButtonUp"
        SizeChanged="Window_SizeChanged"
        RenderTransformOrigin="1,1"
        AllowsTransparency="True">
    <Window.RenderTransform>
        <ScaleTransform x:Name="scaleTransform" ScaleX="1" ScaleY="1"/>
    </Window.RenderTransform>
    <Window.Triggers>
        <EventTrigger RoutedEvent="Window.Loaded">
            <BeginStoryboard>
                <Storyboard>
                    <DoubleAnimation Duration="00:00:00.3" Storyboard.TargetProperty="Opacity" From="0" To="0.99" />
                    <DoubleAnimation Duration="00:00:00.2" Storyboard.TargetName="scaleTransform" Storyboard.TargetProperty="ScaleX" From="0" To="1" />
                    <DoubleAnimation Duration="00:00:00.2" Storyboard.TargetName="scaleTransform" Storyboard.TargetProperty="ScaleY" From="0" To="1" />
                </Storyboard>
            </BeginStoryboard>
        </EventTrigger>
    </Window.Triggers>

    <Grid Margin="10">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>

        <!-- Header Card (Floating Title Bar) -->
        <Border Grid.Row="0" Background="White" CornerRadius="20" Height="40" Margin="0,0,0,10" VerticalAlignment="Top">
            <Border.Effect>
                <DropShadowEffect BlurRadius="10" ShadowDepth="2" Opacity="0.1" Color="Black"/>
            </Border.Effect>
            <Grid Margin="15,0">
                <StackPanel Orientation="Horizontal" HorizontalAlignment="Left" VerticalAlignment="Center">
                    <Image Source="{StaticResource icon.vmping-logo-simple}" Width="16" Height="16" Margin="0,0,8,0"/>
                    <TextBlock Text="Notificaciones vmPing" FontWeight="SemiBold" FontSize="12" Foreground="#64748B" VerticalAlignment="Center"/>
                </StackPanel>

                <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" VerticalAlignment="Center">
                     <!-- Maximize/History -->
                     <Button Click="Maximize_Click" Background="Transparent" BorderThickness="0" Margin="0,0,5,0" ToolTip="Abrir Historial">
                         <Path Data="M3,3H9V9H3V3M3,13H9V19H3V13M13,3H19V9H13V3M13,13H19V19H13V13Z" Fill="#64748B" Stretch="Uniform" Width="10" Height="10"/>
                         <Button.Style>
                            <Style TargetType="Button">
                                <Setter Property="Template">
                                    <Setter.Value>
                                        <ControlTemplate TargetType="Button">
                                            <Border Background="{TemplateBinding Background}" CornerRadius="10" Padding="8">
                                                <ContentPresenter/>
                                            </Border>
                                        </ControlTemplate>
                                    </Setter.Value>
                                </Setter>
                                <Style.Triggers>
                                    <Trigger Property="IsMouseOver" Value="True">
                                        <Setter Property="Background" Value="#F1F5F9"/>
                                        <Setter Property="Cursor" Value="Hand"/>
                                    </Trigger>
                                </Style.Triggers>
                            </Style>
                         </Button.Style>
                     </Button>

                     <!-- Close -->
                     <Button Click="Close_Click" Background="Transparent" BorderThickness="0" ToolTip="Cerrar">
                         <Path Data="M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z" Fill="#64748B" Stretch="Uniform" Width="10" Height="10"/>
                         <Button.Style>
                            <Style TargetType="Button">
                                <Setter Property="Template">
                                    <Setter.Value>
                                        <ControlTemplate TargetType="Button">
                                            <Border Background="{TemplateBinding Background}" CornerRadius="10" Padding="8">
                                                <ContentPresenter/>
                                            </Border>
                                        </ControlTemplate>
                                    </Setter.Value>
                                </Setter>
                                <Style.Triggers>
                                    <Trigger Property="IsMouseOver" Value="True">
                                        <Setter Property="Background" Value="#FEE2E2"/>
                                        <Setter Property="Cursor" Value="Hand"/>
                                    </Trigger>
                                </Style.Triggers>
                            </Style>
                         </Button.Style>
                     </Button>
                </StackPanel>
            </Grid>
        </Border>

        <!-- Notification Cards List -->
        <ListBox Name="StatusHistoryList"
                 Grid.Row="1"
                 Background="Transparent"
                 SelectionMode="Single"
                 BorderThickness="0"
                 IsTabStop="False"
                 FocusVisualStyle="{x:Null}"
                 ScrollViewer.HorizontalScrollBarVisibility="Disabled"
                 ScrollViewer.VerticalScrollBarVisibility="Hidden"
                 MouseLeftButtonUp="Window_MouseLeftButtonUp"
                 Padding="0,0,0,10">
            <ListBox.ItemContainerStyle>
                <Style TargetType="{x:Type ListBoxItem}">
                    <Setter Property="Background" Value="Transparent" />
                    <Setter Property="Margin" Value="0,0,0,8"/>
                    <Setter Property="Focusable" Value="False"/>
                    <Setter Property="Template">
                        <Setter.Value>
                            <ControlTemplate TargetType="{x:Type ListBoxItem}">
                                <ContentPresenter />
                            </ControlTemplate>
                        </Setter.Value>
                    </Setter>
                </Style>
            </ListBox.ItemContainerStyle>
            <ListBox.ItemTemplate>
                <DataTemplate>
                    <Border Background="White" CornerRadius="12" Padding="15,12">
                        <Border.Effect>
                            <DropShadowEffect BlurRadius="8" ShadowDepth="2" Opacity="0.08" Color="#1E293B"/>
                        </Border.Effect>
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>

                            <!-- Status Icon Badge -->
                            <Border Width="36" Height="36" CornerRadius="12" VerticalAlignment="Center">
                                <Border.Style>
                                    <Style TargetType="Border">
                                        <Setter Property="Background" Value="#F1F5F9"/>
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding StatusAsString}" Value="{x:Static resource:Strings.StatusChange_Down}">
                                                <Setter Property="Background" Value="#FEE2E2"/>
                                            </DataTrigger>
                                            <DataTrigger Binding="{Binding StatusAsString}" Value="{x:Static resource:Strings.StatusChange_Error}">
                                                <Setter Property="Background" Value="#FEE2E2"/>
                                            </DataTrigger>
                                            <DataTrigger Binding="{Binding StatusAsString}" Value="{x:Static resource:Strings.StatusChange_Up}">
                                                <Setter Property="Background" Value="#D1FAE5"/>
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </Border.Style>
                                <Path Width="16" Height="16" Stretch="Uniform" Fill="Gray" HorizontalAlignment="Center" VerticalAlignment="Center">
                                    <Path.Style>
                                        <Style TargetType="Path">
                                            <Setter Property="Data" Value="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"/>
                                            <Setter Property="Fill" Value="#64748B"/>
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding StatusAsString}" Value="{x:Static resource:Strings.StatusChange_Down}">
                                                    <Setter Property="Fill" Value="#DC2626"/>
                                                </DataTrigger>
                                                <DataTrigger Binding="{Binding StatusAsString}" Value="{x:Static resource:Strings.StatusChange_Up}">
                                                     <Setter Property="Data" Value="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                                                     <Setter Property="Fill" Value="#059669"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </Path.Style>
                                </Path>
                            </Border>

                            <!-- Content -->
                            <StackPanel Grid.Column="1" Margin="15,0" VerticalAlignment="Center">
                                <TextBlock Text="{Binding AliasIfExistOrHostname}" FontSize="15" FontWeight="Bold" Foreground="#1E293B" TextTrimming="CharacterEllipsis"/>
                                <TextBlock Text="{Binding StatusAsString}" FontSize="13" FontWeight="Medium" Margin="0,2,0,0">
                                    <TextBlock.Style>
                                        <Style TargetType="TextBlock">
                                            <Setter Property="Foreground" Value="#64748B"/>
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding StatusAsString}" Value="{x:Static resource:Strings.StatusChange_Down}">
                                                    <Setter Property="Foreground" Value="#DC2626"/>
                                                </DataTrigger>
                                                <DataTrigger Binding="{Binding StatusAsString}" Value="{x:Static resource:Strings.StatusChange_Up}">
                                                    <Setter Property="Foreground" Value="#059669"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </TextBlock.Style>
                                </TextBlock>
                            </StackPanel>

                            <!-- Time -->
                            <TextBlock Grid.Column="2" Text="{Binding Timestamp, StringFormat='{}{0:HH:mm}'}" FontSize="12" Foreground="#94A3B8" VerticalAlignment="Top" Margin="10,2,0,0"/>

                        </Grid>
                    </Border>
                </DataTemplate>
            </ListBox.ItemTemplate>
        </ListBox>
    </Grid>
</Window>
